<img src="img/loader.gif" ng-show="!document && !error" />

<div ng-show="error" class="well-lg">
  <p class="text-center" ng-show="error.status == 404">
    <span class="glyphicon glyphicon-warning-sign"></span>
    {{ 'document.view.not_found' | translate }}
  </p>
  <p class="text-center" ng-show="error.status == 403">
    <span class="glyphicon glyphicon-warning-sign"></span>
    {{ 'document.view.forbidden' | translate }}
  </p>
</div>

<div ng-show="document">
	<div class="pull-right">
	  <div class="dropdown" uib-dropdown ng-class="{ 'btn-group': document.writable }">
      <button class="btn btn-default" uib-dropdown-toggle>
        <span class="glyphicon glyphicon-export"></span>
        {{ 'export' | translate }}
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu">
        <li>
          <a ng-href="../api/file/zip?id={{ document.id }}">
            <span class="glyphicon glyphicon glyphicon-compressed"></span>
            {{ 'document.view.download_files' | translate }}
          </a>
        </li>
        <li>
          <a href ng-click="exportPdf()">
            <span class="glyphicon glyphicon glyphicon-save-file"></span>
            {{ 'document.view.export_pdf' | translate }}
          </a>
        </li>
      </ul>
	    <button class="btn btn-danger" ng-show="document.writable" ng-click="deleteDocument(document)"><span class="glyphicon glyphicon-trash"></span> {{ 'delete' | translate }}</button>
	    <a href="#/document/edit/{{ document.id }}" ng-show="document.writable" class="btn btn-primary"><span class="glyphicon glyphicon-pencil"></span> {{ 'edit' | translate }}</a>
	  </div>
	</div>
	
	<div class="page-header">
	  <h1>
      {{ document.title }}
      <small>{{ document.create_date | date: dateFormat }}
      {{ 'document.view.by_creator' | translate }} <a href="#/user/{{ document.creator }}">{{ document.creator }}</a></small>
    </h1>

	  <p ng-show="document.writable">
	    <button class="btn btn-sm btn-info" ng-click="share()">
        <span class="glyphicon glyphicon-share"></span> {{ 'share' | translate }}
      </button>

      <span ng-repeat="share in document.acls | filter: { 'type': 'SHARE' }">
        <button class="btn btn-default btn-sm" ng-click="showShare(share)">
          <span class="glyphicon glyphicon-ok"></span> {{ share.name ? share.name : 'shared' }}
        </button>
      </span>
	  </p>

	  <ul class="list-inline">
	    <li ng-repeat="tag in document.tags">
        <span class="label label-info" ng-style="{ 'background': tag.color }">{{ tag.name }}</span>
      </li>
	  </ul>
	</div>

  <div class="row">
    <div class="col-md-9">
      <ul class="nav nav-tabs">
        <li ng-class="{ active: $state.current.name == 'document.view.content' }">
          <a href="#/document/view/{{ document.id }}/content">
            <span class="glyphicon glyphicon-file"></span> {{ 'document.view.content' | translate }}
          </a>
        </li>
        <li ng-class="{ active: $state.current.name == 'document.view.permissions' }">
          <a href="#/document/view/{{ document.id }}/permissions">
            <span class="glyphicon glyphicon-user"></span> {{ 'document.view.permissions' | translate }}
          </a>
        </li>
        <li ng-class="{ active: $state.current.name == 'document.view.activity' }">
          <a href="#/document/view/{{ document.id }}/activity">
            <span class="glyphicon glyphicon-tasks"></span> {{ 'document.view.activity' | translate }}
          </a>
        </li>
      </ul>
      <div ui-view="tab"></div>
    </div>
    <div class="col-md-3">
      <p class="page-header page-header-comments">
        <span class="glyphicon glyphicon-comment"></span>
        {{ 'document.view.comments' | translate }}
      </p>

      <div ng-show="!comments || comments.length == 0" class="text-center text-muted">
        <h1 class="glyphicon glyphicon-comment"></h1>
        <p ng-show="!comments && !commentsError">{{ 'loading' | translate }}</p>
        <p ng-show="comments.length == 0">{{ 'document.view.no_comments' | translate }}</p>
        <p ng-show="!comments && commentsError">{{ 'document.view.error_loading_comments' | translate }}</p>
      </div>

      <div ng-repeat="comment in comments" class="media" style="overflow: hidden">
        <div class="pull-left">
          <img ng-src="http://www.gravatar.com/avatar/{{ comment.creator_gravatar }}?s=40&d=identicon" class="media-object" />
        </div>
        <div class="media-body">
          <strong>{{ comment.creator }}</strong>
          <p>
            {{ comment.content }}<br />
            <span class="text-muted">{{ comment.create_date | timeAgo: dateTimeFormat }}</span>
          <span class="text-muted pull-right btn-link pointer"
                ng-show="document.writable || userInfo.username == comment.creator"
                ng-click="deleteComment(comment)">
            <span class="glyphicon glyphicon-remove"></span>
          </span>
          </p>
        </div>
      </div>

      <form ng-submit="addComment()">
        <div class="form-group">
          <label class="sr-only" for="commentInput">{{ 'document.view.add_comment' | translate }}</label>
          <input type="text" class="form-control" id="commentInput" ng-model="comment" ng-attr-placeholder="{{ 'document.view.add_comment' | translate }}">
        </div>
      </form>
    </div>
  </div>
</div>